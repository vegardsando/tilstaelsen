function showEventCreator(e,t){eventCreatorShown||(eventCreatorShown=!0,$("<div />").qtip({content:{text:$("#event-creator"),title:Craft.t("new_event")},position:{my:"center",at:"center",target:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:{classes:"qtip-bootstrap dialogue",width:500},events:{render:function(a,r){var n=r.elements.content;$("ul.errors",n).empty();var i=e.utc().format("HHmmss"),s=t.utc().format("HHmmss"),l=!1;i===s&&"000000"==s&&(t.subtract(1,"seconds"),l=!0);var d=createDateAsUTC(e.toDate()),o=createDateAsUTC(t.toDate()),c=$("#event-creator");c.addClass("shown");var m=$("#startDate-date",c),u=$("#startDate-time",c),v=$("#endDate-date",c),p=$("#endDate-time",c);m.datepicker("setDate",d),v.datepicker("setDate",o),u.timepicker("setTime",d),p.timepicker("setTime",o);var f=$("input[name=allDay]"),h=f.parents(".lightswitch:first");$("input",h).val(l?1:""),l?(h.data("lightswitch").turnOn(),$(".timewrapper",c).hide()):(h.data("lightswitch").turnOff(),$(".timewrapper",c).show()),setTimeout(function(){$("input[name=title]:first",n).val("").focus().bind("keypress",function(e){var t=e.which?e.which:e.keyCode;13==t&&$("button.submit",n).trigger("click")})},100),$("button.submit",n).unbind("click").click(function(e){var t=$("input[name=title]",n).val(),a=$("select[name=calendarId]",n).val(),i=moment(m.datepicker("getDate")),s=moment(u.timepicker("getTime")),l=moment(v.datepicker("getDate")),d=moment(p.timepicker("getTime")),o={startDate:i.format("YYYY-MM-DD")+" "+s.format("HH:mm:ss"),endDate:l.format("YYYY-MM-DD")+" "+d.format("HH:mm:ss"),allDay:f.val(),event:{title:t,calendarId:a}};o[csrfTokenName]=csrfTokenValue,$.ajax({url:Craft.getCpUrl("calendar/events/api/create"),type:"post",dataType:"json",data:o,success:function(t){t.error?$("ul.errors",n).empty().append($("<li />",{text:t.error})):t.event&&($calendar.fullCalendar("renderEvent",t.event),$calendar.fullCalendar("unselect"),r.hide(e))},error:function(e){alert(e)}})}),$("button.delete",n).unbind("click").click(function(e){r.hide()})},hide:function(e,t){$("#event-creator").removeClass("shown").insertAfter($calendar),$calendar.fullCalendar("unselect"),eventCreatorShown=!1,t.destroy()}}}))}function buildEventPopup(e,t){if(e.calendar){var a=$("<div>"),r=$("<div>",{class:"calendar-data",html:'<span class="color-indicator" style="background-color: '+e.backgroundColor+';"></span> '+e.calendar.name}),n=moment(e.start),i=moment(e.end),s="dddd, MMMM D, YYYY";if(e.allDay)i.subtract(1,"days");else{var l="H:i"==calendarTimeFormat?"HH:mm":"h:mma";s=s+" \\a\\t "+l}var d=$("<div>",{class:"event-date-range separator",html:'<div style="white-space: nowrap;"><label>Starts:</label>'+n.format(s)+'</div><div style="white-space: nowrap;"><label>Ends:</label>'+i.format(s)+"</div>"}),o="";if(e.repeats&&(o=$("<div>",{class:"event-repeats separator",html:"<label>Repeats:</label>"+e.readableRepeatRule})),e.editable){var c=$("<div>",{class:"buttons"});c.append($("<a>",{class:"btn small submit",href:Craft.getCpUrl("calendar/events/"+e.id),text:Craft.t("event_edit")})),c.append($("<a>",{class:"btn small delete-event",href:Craft.getCpUrl("calendar/events/api/delete"),text:Craft.t("event_delete"),data:{id:e.id}})),e.repeats&&c.append($("<a>",{class:"btn small delete-event-occurrence",href:Craft.getCpUrl("calendar/events/api/deleteOccurrence"),text:Craft.t("event_delete_occurrence"),data:{id:e.id,date:e.start.toISOString()}}))}t.qtip({content:{title:e.title,button:!0,text:a.add(r).add(d).add(o).add(c)},style:{classes:"qtip-bootstrap qtip-event",tip:{width:30,height:15}},position:{my:"right center",at:"left center",viewport:$(window),adjust:{method:"shift flip"}},show:{solo:!0,delay:500},hide:{fixed:!0,delay:300},events:{show:function(e,t){qTipsEnabled||e.preventDefault()},render:function(t,a){$("a.delete-event-occurrence",a.elements.content).click(function(t){var r=$(this).attr("href"),n=$(this).data("id"),i=$(this).data("date");if(confirm(Craft.t("event_delete_occurrence_confirmation"))){var s={eventId:n,date:i};s[csrfTokenName]=csrfTokenValue,$.ajax({url:r,type:"post",dataType:"json",data:s,success:function(t){return t.error?void alert(t.error):($calendar.fullCalendar("removeEvents",function(t){return t.id==e.id&&t.start.isSame(e.start)}),void a.destroy())}})}return!1}),$("a.delete-event",a.elements.content).click(function(t){var r=$(this).attr("href"),n=$(this).data("id");if(confirm(Craft.t("event_delete_confirmation"))){var i={eventId:n};i[csrfTokenName]=csrfTokenValue,$.ajax({url:r,type:"post",dataType:"json",data:i,success:function(t){return t.error?void alert(t.error):($calendar.fullCalendar("removeEvents",e.id),void a.destroy())}})}return!1})}}})}}function createDateAsUTC(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}var eventCreatorShown=!1;