function convertDateFormatToMomentFormat(e){return e=e.replace(/m/g,"M").replace(/d/g,"D").replace(/yy/g,"YYYY")}function getDayAbbreviationFromDay(e){switch(e=parseInt(e)){case 0:return"SU";case 1:return"MO";case 2:return"TU";case 3:return"WE";case 4:return"TH";case 5:return"FR";case 6:return"SA"}throw"Wrong day given: "+e+". Expected 0-6"}$(function(){"use strict";$(".calendar-event-wrapper").each(function(){var e=$(this),t=$("#calendarEventstartDate-date",e),a=$("#calendarEventstartDate-time",e),n=$("#untilChoice",e),r=$("#calendarEventcount",e),c=$("#calendarEventuntilDate-date",e),i=$("#calendarEventexceptionDate-date",e),o=$("#calendarEventselectDate-date",e),s=$("#calendarEventendDate-date",e),d=$("#calendarEventendDate-time",e),p=$("#tabs a.tab");a.timepicker("option","step",calendarTimeInterval),d.timepicker("option","step",calendarTimeInterval),t.datepicker("option","onSelect",function(a){s.datepicker("option","minDate",a),s.val(a),o.datepicker("option","minDate",a),o.datepicker("option","defaultDate",a),c.datepicker("option","defaultDate",a);var n=t.datepicker("getDate");if(n){n=new moment(n);var r=getDayAbbreviationFromDay(n.format("d")),i=n.format("D"),d=n.format("M"),p=n.toDate().getNthOfMonth();p>4&&(p=-1);var l=$(".recurrence-block.recurs-weekly .days",e);$("input:checkbox:checked",l).length<=1&&($("input:checkbox:checked",l).prop("checked",!1),$("input:checkbox[value="+r+"]",l).prop("checked",!0));var h=$(".recurrence-block.recurs-monthly .days",e);$("input:checkbox:checked",h).length<=1&&($("input:checkbox:checked",h).prop("checked",!1),$("input:checkbox[value="+r+"]",h).prop("checked",!0));var u=$(".recurrence-block.recurs-monthly .month-days",e);$("input:checkbox:checked",u).length<=1&&($("input:checkbox:checked",u).prop("checked",!1),$("input:checkbox[value="+i+"]",u).prop("checked",!0)),$('select[name="calendarEvent[monthly][repeatsByDayInterval]"]').val(p),$('select[name="calendarEvent[yearly][repeatsByDayInterval]"]').val(p);var v=$(".recurrence-block.recurs-yearly .months",e);$("input:checkbox:checked",v).length<=1&&($("input:checkbox:checked",v).prop("checked",!1),$("input:checkbox[value="+d+"]",v).prop("checked",!0));var m=$(".recurrence-block.recurs-yearly .days",e);$("input:checkbox:checked",m).length<=1&&($("input:checkbox:checked",m).prop("checked",!1),$("input:checkbox[value="+r+"]",m).prop("checked",!0))}}),a.on("change",function(){var n=t.datepicker("getDate"),r=s.datepicker("getDate"),c=0;n&&r&&(c=Math.round((r-n)/864e5));var i=a.timepicker("getTime"),o=a.timepicker("getTime");if(i){if(o.setMinutes(i.getMinutes()+parseInt(calendarEventDuration)),d.timepicker("option","durationTime",i),0==c){var p=a.timepicker("getTime");p.setMinutes(i.getMinutes()+parseInt(calendarTimeInterval)),d.timepicker("option","showDuration",!0),d.timepicker("option","minTime",p),$(this).val()&&d.timepicker("setTime",o)}else d.timepicker("option","showDuration",!1),d.timepicker("option","minTime","00:00"),$(this).val()&&d.timepicker("setTime",i);$(".calendarCalendarSelect",e).trigger("change")}}),d.on("change",function(){$(".calendarCalendarSelect",e).trigger("change")}),s.on("change",function(){a.trigger("change")});var l=$(".event-all-day .lightswitch",e);l.on({change:function(){var t=$('[data-affected-by="all-day-toggle"] .timewrapper',e),a=$(".cal-date-row",e);$("input",this).val()?(t.hide(),a.addClass("short")):(setTimeout(function(){t.fadeIn("fast")},300),a.removeClass("short"))}});var h=$(".recurrence-switch .lightswitch",e);h.on({change:function(){var t=$(".recurrence-choices",e),a=$(".recurrence-wrapper",e);$("input",this).val()?(t.removeClass("no-show"),a.show()):(t.addClass("no-show"),a.hide())}});var u=$('input[type=checkbox][name$="[yearly][repeatsBy]"]',e);u.on({change:function(){var t=$(".recurs-yearly",e);$(this).is(":checked")?t.slideDown("fast"):t.slideUp("fast")}});var v=$(".event-frequency select",e);v.on({change:function(){var t=$(this).val(),a=$(".recurs-weekly",e),n=$(".recurs-monthly",e),r=$(".recurs-yearly",e),c=$(".recurrence-choice-monthly",e),i=$(".recurrence-choice-yearly",e),o=$(".until-switch",e),s=$(".exception-dates-wrapper",e),d=$(".select-dates-wrapper",e),p=$(".event-interval",e);switch(a.slideUp("fast"),n.slideUp("fast"),r.slideUp("fast"),c.slideUp("fast"),i.slideUp("fast"),o.hide(),s.hide(),d.hide(),p.hide(),t){case"WEEKLY":a.slideDown("fast");break;case"MONTHLY":n.slideDown("fast"),c.slideDown("fast");break;case"YEARLY":i.slideDown("fast"),u.trigger("change")}switch(t){case"DAILY":case"WEEKLY":case"MONTHLY":case"YEARLY":o.show(),s.show(),p.show();break;case"SELECT_DATES":d.show()}}});var m=$('input[type=radio][name$="[monthly][repeatsBy]"]',e);m.on({change:function(){if($(this).is(":checked")){var t=$(".recurs-monthly div.days",e),a=$(".recurs-monthly div.month-days",e);t.slideUp("fast"),a.slideUp("fast"),"byMonthDay"==$(this).val()?a.slideDown("fast"):t.slideDown("fast")}}});var k=$("ul.date-list",e);k.on({click:function(){var e=$(this),t=e.parents("li:first");t.parents("ul:first");t.remove()}},"> li > a"),n.on({change:function(){var e=$(this).val();switch(c.parents("li:first").hide(),r.parents("li:first").hide(),e){case"until":c.parents("li:first").fadeIn("fast");break;case"count":r.parents("li:first").fadeIn("fast")}}}),i.datepicker("option","onSelect",function(t){var a=new moment(t,convertDateFormatToMomentFormat(Craft.datepickerOptions.dateFormat)),n=$("<li />"),r=$("<input />");r.attr("type","hidden").attr("name","calendarEvent[exceptions][]").val(a.format("YYYY-MM-DD")),n.append("<a></a>").append("<span>"+a.format("dddd, MMMM D, YYYY")+"</span>").append(r),$(".exception-list",e).append(n),i.val("")}),o.datepicker("option","onSelect",function(t){var a=new moment(t,convertDateFormatToMomentFormat(Craft.datepickerOptions.dateFormat)),n=$("<li />"),r=$("<input />");r.attr("type","hidden").attr("name","calendarEvent[selectDates][]").val(a.format("YYYY-MM-DD")),n.append("<a></a>").append("<span>"+a.format("dddd, MMMM D, YYYY")+"</span>").append(r),$(".select-date-list",e).append(n),o.val("")}),o.datepicker("option","minDate",t.datepicker("getDate")),l.trigger("change"),u.trigger("change"),h.trigger("change"),v.trigger("change"),m.trigger("change"),n.trigger("change"),p.on({click:function(){var e=$(this);return e.parent().siblings().find(".tab.sel").removeClass("sel"),e.addClass("sel"),$(".tab-content").addClass("hidden"),$(".tab-content[data-for-tab="+e.data("tab-id")+"]").removeClass("hidden"),!1}})})}),Date.prototype.getWeekOfMonth=function(e){var t=this.getMonth(),a=this.getFullYear(),n=new Date(a,t,1).getDay(),r=new Date(a,t+1,0).getDate(),c=this.getDate()+n-1,i=1,o=i+Math.ceil((r+n-7)/7),s=i+Math.floor(c/7);return e||2+i>s?s:s===o?i+5:s},Date.prototype.getNthOfMonth=function(){return Math.ceil(this.getDate()/7)};